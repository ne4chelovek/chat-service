# Chat Service

–°–µ—Ä–≤–∏—Å —á–∞—Ç–∞, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –Ω–∞ **gRPC-—Å—Ç—Ä–∏–º–∏–Ω–≥–µ** –¥–ª—è –æ–±–º–µ–Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.  
–†–∞–±–æ—Ç–∞–µ—Ç –≤ Docker, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **—Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é PostgreSQL (`pg-chat`)** –∏ **–æ–±—â—É—é Kafka-–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É** –æ—Ç [
`auth-service`](https://github.com/ne4chelovek/auth-service).

---

## üöÄ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

- **–°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞** ‚Äî —Å —É–∫–∞–∑–∞–Ω–∏–µ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- **–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —á–∞—Ç–µ** –ø–æ ID
- **–£–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞**
- **–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —á–∞—Ç—É —á–µ—Ä–µ–∑ gRPC-—Å—Ç—Ä–∏–º–∏–Ω–≥** ‚Äî –æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π (—Å–µ—Ä–≤–µ—Ä–Ω—ã–π) –ø–æ—Ç–æ–∫
- **–û—Ç–ø—Ä–∞–≤–∫–∞ –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏**
- **REST API** —á–µ—Ä–µ–∑ `grpc-gateway` (–∞–≤—Ç–æ-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑ `.proto`)
- **WebSocket-—à–ª—é–∑** ‚Äî –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç gRPC-—Å—Ç—Ä–∏–º –≤ WebSocket –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ —Å –±—Ä–∞—É–∑–µ—Ä–∞
- **JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è** —á–µ—Ä–µ–∑ `auth-service`
- **–û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π –∏–∑ Kafka** ‚Äî —á—Ç–µ–Ω–∏–µ —Ç–æ–ø–∏–∫–∞ `user_session_events` (–≤—Ö–æ–¥/–≤—ã—Ö–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π)
- **Swagger UI** ‚Äî –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è REST API

> ‚ö†Ô∏è **WebSocket-—à–ª—é–∑ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Å—Ç–∞–¥–∏–∏ –¥–æ—Ä–∞–±–æ—Ç–∫–∏**

---

## üì¶ –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- Go 1.23+
- gRPC + gRPC-Gateway
- gRPC-Streaming (–æ–¥–Ω–æ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π)
- WebSocket
- PostgreSQL (—Å–≤–æ—è –ë–î ‚Äî `pg-chat`)
- Kafka (consumer —Ç–æ–ø–∏–∫–∞ `user_session_events`)
- TLS –¥–ª—è gRPC
- Cobra CLI ‚Äî –∫–æ–Ω—Å–æ–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —á–∞—Ç–∞
- Docker + Docker Compose

---

## üß∞ –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:

- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã [Docker](https://docs.docker.com/get-docker/) –∏ [Docker Compose](https://docs.docker.com/compose/install/)
- `auth-service` –∑–∞–ø—É—â–µ–Ω ‚Äî –æ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç:
    - Kafka (`kafka1`)
    - ZooKeeper
    - `auth-service` (–¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏)

---

## üõ† –ó–∞–ø—É—Å–∫

### –ó–∞–ø—É—Å—Ç–∏—Ç–µ `chat-service` (–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞)

```bash
git clone https://github.com/ne4chelovek/chat-service
cd ../chat-service
docker-compose up --build -d
```

### –ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å—ã –¥–æ—Å—Ç—É–ø–Ω—ã:

- gRPC: localhost:9070
- REST API: http://localhost:8080
- Swagger UI: http://localhost:8090
- WebSocket: ws://localhost:8080/ws/chat?chat_id=1

---

## üíª CLI 

–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ: chat-service/cli.

–°–±–æ—Ä–∫–∞: `go build -o bin/mikle main.go`

### –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

- –ü–æ–º–æ—â—å –ø–æ CLI:

````
  bin/mikle --help
````

- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

````
  bin/mikle register --username <–∏–º—è> --email <email> --password <–ø–∞—Ä–æ–ª—å>
````

- –í—Ö–æ–¥ (–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è):

````
  bin/mikle login
````

- –í—ã—Ö–æ–¥ (—É–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞):

````
  bin/mikle logout
````

- –°–æ–∑–¥–∞–Ω–∏–µ —á–∞—Ç–∞:

````
  bin/mikle create --users user1,user2,user3
````

- –£–¥–∞–ª–µ–Ω–∏–µ —á–∞—Ç–∞:

````
  bin/mikle delete --chat-id 5
````

- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —á–∞—Ç—É (–ø—Ä–æ—Å–º–æ—Ç—Ä —Å–æ–æ–±—â–µ–Ω–∏–π):

````
  bin/mikle connect --chat-id 5
````
 
